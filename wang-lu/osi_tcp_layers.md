# OSI與TCP分層

## OSI與TCP/IP模型

ISO所制定的標準中，牽涉到網路通訊方面的就是開放式系統互連 \( Open Systems Interconnection, OSI \) 分層模型，是在1970 年代後期所提出來的。 

OSI模型是一個概念模型，它建立了一個框架，說明資訊該如何從應用程式、透過網路連線、經過實體的傳輸線，最後來到目標網站或主機。在 OSI模型當中有七層的架構，每一層都有其相對應的協定，定義了資訊傳出的規範。

相較於 OSI模型的七層架構，TCP/IP模型只有四層。雖然說是簡化，但實際上整體的架構還是不脫 OSI 模型的內容。

![OSI 7&#x5C64;&#x8207;TCP/IP 4&#x5C64;&#x5C0D;&#x7167;&#x5716;](../.gitbook/assets/osi_tcp_mapping.png)

### 應用層 \(Application Layer \)

在應用層當中的協定，定義了應用程式透過網路交換資訊的格式，常見的有 HTTP、HTTPS、FTP \(檔案傳輸\)、POP3 \(接受電子郵件\)、SMTP \(發電子郵件\)、TELNET、SSH 等。

### 傳輸層 \(Transportation layer\)

在傳輸層當中的協定，定義了傳輸資料的品質（可靠性與順序性），譬如常見的 TCP 與 UDP 協議。

### 網路層 \(Internet layer\)

網路層當中的協定則定義了資料如何在一個單一網路上傳輸並可以抵達目的地。這裡其實就是靠著先前提到的 IP地址來找到目標位置。

### 實體層 \(physical layer\)

最後的實體層則定義資訊如何透過韌體與硬體間傳遞與接收。

在開發網路應用程式的過程當中，設計師大部分關注多在應用層，因為傳輸層與網路層實作，多半已由作業系統完成\(Windows socket, BSD socket等\)，而實體層則靠電腦與網路設備完成。

## TCP vs. UDP

TCP 和 UDP 都是透過同樣的方式傳輸資料，並透過 IP 找到目標。不過兩者因為性質上的差異，所以應用場景也有很大的不同。

TCP 用於需要「可靠通訊」的場景，即資料在傳輸的過程中不會遺漏，而且有正確的順序性。大部分情況下我們都需要 TCP 來保證通訊的可靠性。

相對於 TCP，UDP 有時也被稱作「不可靠的通訊」。因為 TCP 為了保證「可靠」，必須依賴相對應的機制，而這些機制會使用較多的資源，並降低傳輸效率。而在某些使用場景，像是網路電話、視訊會議、遊戲等，更看重傳輸速度與即時性，品質方面可以稍微犧牲，因此就可以採用 UDP 的傳輸方式。

另一方面，UDP 可以做到一對多的廣播功能，而 TCP 就只能夠一對一通訊。

## TCP 3-Way handshake & 4-Way handshake

TCP 為了在通訊連線前，確認對方可以準備接收訊號，以及在斷線前，確認對方準備好離線，因此發展出了連線前的 3-way handshake 與離線前的 4-way handshake 機制。

### 連線前的 3-way handshake

* CLIENT: 傳送通訊連線請求
* SERVER: 確認允許連線
* CLIENT: 確認連線

### 離線前的 4-way handshake

* CLIENT: 傳送通訊斷線請求
* SERVER: 確認收到斷線請求，並繼續傳送最後的資訊
* SERVER: 最後的資訊傳送完畢，確認可以斷線
* CLIENT: 確認斷線





![TCP&#x9023;&#x7DDA;&#x72C0;&#x614B;&#x5716;](../.gitbook/assets/tcp_connection_states.jpg)

## 埠\(Port\)的分類

從埠的性質來分，通常可以分為以下三類：

* **公認埠（Well Known Ports）**：這類埠也常稱之為常用埠。這類埠的埠號從0到1023，它們緊密繫結於一些特定的服務。
* **註冊埠（Registered Ports）**：埠號從1024到49151。它們鬆散地繫結於一些服務。也是說有許多服務繫結於這些埠，這些埠同樣用於許多其他目的。
* **動態和/或私有埠（Dynamic and/or Private Ports）**：埠號從49152到65535。

